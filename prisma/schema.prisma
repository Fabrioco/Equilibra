generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  resetToken     String?
  tokenExpiresAt DateTime?

  privacyMode         Boolean @default(false)
  enableNotifications Boolean @default(true)
  plan                Plan    @default(FREE)

  asaasCustomerId String? @unique
  subscriptionStatus subscriptionStatus?
  asaasSubscriptionId String?

  transactions Transaction[]
  goals        Goal[]
}

model Transaction {
  id         Int                   @id @default(autoincrement())
  title      String
  amount     Decimal               @db.Decimal(10, 2)
  category   String
  type       TransactionType
  recurrence TransactionRecurrence @default(ONE_TIME)

  // Parcelamento
  totalInstallment   Int?
  installmentIndex   Int?
  installmentGroupId String?

  date      DateTime @db.Date
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Goal {
  id            Int      @id @default(autoincrement())
  title         String
  amountCurrent Decimal  @default(0) @db.Decimal(10, 2)
  amountGoal    Decimal  @db.Decimal(10, 2)
  date          DateTime @db.Date

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum TransactionRecurrence {
  ONE_TIME
  FIXED
  INSTALLMENT
}

enum Plan {
FREE      
  ESSENCIAL 
  PRO       
  ELITE     
}

enum subscriptionStatus {
  ATIVO
  CANCELADO
  PENDENTE
}